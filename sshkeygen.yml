- name: Generate ssh key
  hosts: localhost
  connection: local
  become: yes
  vars_prompt:
  - name: "keypath"
    prompt: "Enter ssh key path"
    private: false
    unsafe: true
  - name: "keyname"
    prompt: "Enter ssh key name without extension"
    private: false
  tasks:
  - name: generate ssh key
    community.crypto.openssh_keypair:
      #path: ' "{{ keypath }}""{{ keyname }}" '
      path: '{{ keypath }}/{{ keyname }}'
      type: rsa
      size: 4096
      state: present
      force: no
  - name: Set authorized key taken from file
    authorized_key:
      user: "{{ keyname }}"
      state: present
      key: "{{ lookup('file', '{{ keypath }}/{{ keyname }}.pub') }}"
